# YouTube 熱門影片追蹤系統 - 開發進度 v2.0

## 🎯 系統狀態

### ✅ v2.0 已完成的重大功能

#### 🏗️ 階層檔案結構系統
- [x] 實現 YouTube Analytics Data/年份/月份檔案/每日分頁 結構
- [x] 智能按需建立：只建立今日+明日分頁
- [x] 自動邊界處理：跨月、跨年自動建立新結構
- [x] 重複執行友好：跳過已存在結構，零浪費

#### 📊 數據結構簡化
- [x] 移除歷史累積：從複雜的 History 欄位改為每日快照
- [x] 簡化欄位結構：從 16 欄減少為 14 欄
- [x] 每日數據快照：recordDate, viewCount, likeCount, commentCount
- [x] 標題行自動修復：確保新舊分頁都有正確標題

#### 🌐 地區擴展
- [x] 新增三個地區：巴西(BR)、印尼(ID)、墨西哥(MX)
- [x] 地區配置優化：query 和 lang 設定
- [x] 總計六個地區：TW, US, IN, BR, ID, MX

#### 🚀 核心函數重構
- [x] `ensureTodayStructureExists()` - 智能結構檢查
- [x] `trackRegionToDaily()` - 新版每日追蹤
- [x] `addDailyRecord()` - 簡化數據寫入
- [x] `createSheetIfNotExists()` - 智能分頁建立
- [x] `setupHierarchicalStructure()` - 初始化結構建立

### 📊 當前系統規格 v2.0
- **追蹤地區**: 美國、印度、台灣、巴西、印尼、墨西哥 (6個地區)
- **影片類型**: 一般影片（所有長度）+ Shorts 短影片（≤60秒）
- **排名數量**: 每個地區類型前 20 名
- **搜尋範圍**: 過去 5 天發佈的影片
- **檔案組織**: 每月一檔案，每日一分頁
- **數據收集**: 當日觀看數、按讚數、留言數快照

### 🔄 已完成改進
- [x] 更新所有 *.md 文檔反映 v2.0 功能
- [x] 修復分頁標題行問題
- [x] 永續運行設計：永不觸及 Google Sheets 限制

### 📋 未來改進計劃
- [ ] 實現動態網頁分析界面
- [ ] 監控 API 配額使用情況和優化
- [ ] 建立更完善的 API 錯誤處理機制
- [ ] 增加跨時間數據分析功能

---

## 📊 YouTube API 調用流程 v2.0

### 當前配額使用量
- **每日追蹤次數：** 12 次 (6地區 × 2類型)
- **每次 API 調用：** 2 次 (Search + Videos)
- **每日總配額：** 24 單位
- **YouTube 免費限額：** 10,000 單位/天
- **使用率：** 0.24%

### v2.0 數據流程
1. **結構檢查** → ensureTodayStructureExists()
2. **API 查詢** → searchVideos() → 6地區並行處理
3. **數據寫入** → trackRegionToDaily() → 每日分頁直接寫入
4. **邊界處理** → 自動建立跨月、跨年結構

---

## 🗄 v2.0 數據結構

### 階層檔案結構
```
YouTube Analytics Data/
├── 2024/
│   ├── 2024-09 (每日分頁: 01, 02, ..., 30)
│   ├── 2024-10 (每日分頁: 01, 02, ..., 31)
│   └── ...
├── 2025/
│   ├── 2025-01
│   └── ...
```

### 每日分頁數據結構（14 欄）
```
1. rank              - 排名（依地區類型分開）
2. videoId           - YouTube 影片 ID
3. title             - 影片標題
4. channelTitle      - 頻道名稱
5. publishedAt       - 發佈時間
6. region            - 地區（US/IN/TW/BR/ID/MX）
7. type              - 類型（videos/shorts）
8. recordDate        - 記錄日期
9. url               - YouTube 連結
10. viewCount        - 當日觀看數
11. likeCount        - 當日按讚數
12. commentCount     - 當日留言數
13. hashtags         - 提取的 hashtag
14. durationSeconds  - 影片長度（秒數）
```

---

## 🔍 v2.0 邊界處理邏輯

### 三種邊界情況自動處理

#### 1. 同月邊界（正常）
```
2024/09/17 → 2024/09/18
✅ 同一月份檔案，建立新分頁
```

#### 2. 跨月邊界
```
2024/09/30 → 2024/10/01
✅ 建立新月份檔案 + 新分頁
```

#### 3. 跨年邊界
```
2024/12/31 → 2025/01/01
✅ 建立新年份資料夾 + 新月份檔案 + 新分頁
```

### 智能建立策略
- **第一次執行**: 建立今日+明日分頁
- **重複執行**: 跳過已存在結構
- **跨邊界**: 自動建立必要結構

---

## ⚡ v2.0 性能優勢

### 擴展性改進
| 項目 | v1.0 | v2.0 | 改善 |
|------|------|------|------|
| **檔案結構** | 單一檔案 | 階層結構 | ♾️ 無限制 |
| **數據組織** | 歷史累積 | 每日分頁 | ✨ 清晰時間組織 |
| **地區數量** | 3 個 | 6 個 | +100% |
| **維護成本** | 高 | 零維護 | ✅ 自動化 |
| **邊界處理** | 手動 | 自動智能 | 🤖 零人工干預 |

### 執行效率
- **按需建立**: 避免過度工程，只建立必要結構
- **重複友好**: 多次執行不重複建立已存在項目
- **邊界智能**: 自動偵測並處理複雜邊界情況

---

## 🛠️ v2.0 實現細節

### 核心重構函數

#### `ensureTodayStructureExists()`
- **職責**: 智能檢查並建立今日必要結構
- **邊界處理**: 自動偵測跨月、跨年情況
- **性能**: 重複執行時跳過已存在結構

#### `trackRegionToDaily()`
- **職責**: 新版追蹤邏輯，直接寫入每日分頁
- **簡化**: 移除歷史累積，每日重新排名
- **效率**: 單一函數處理所有地區類型

#### `createSheetIfNotExists()`
- **職責**: 智能分頁建立與標題行管理
- **修復**: 自動檢查並修復舊分頁標題行
- **標準**: 確保所有分頁都有正確的 14 欄標題

---

## 📈 優化建議

### 已實現優化
- [x] 階層檔案結構實現永續運行
- [x] 智能邊界處理消除手動維護
- [x] 數據結構簡化提高可讀性
- [x] 地區擴展提供全球視野

### 未來規劃
- [ ] 建立動態網頁分析界面
- [ ] 實現跨時間數據趨勢分析
- [ ] 加入 API 調用重試機制
- [ ] 實現數據視覺化功能

---

## 🔗 相關文件
- [README.md](./README.md) - 專案概覽與功能介紹
- [beginner.md](./beginner.md) - 新手完整教學
- [develop.md](./develop.md) - 進階開發指南
- [CLAUDE.md](./CLAUDE.md) - AI 助手工作指南

---

**最後更新：** 2025-09-17
**維護者：** AI Assistant (Claude)
**版本：** 2.0 - 階層檔案結構版